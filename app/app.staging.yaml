# Google App Engine configuration for staging environment
# Staging service for testing before production deployment

runtime: nodejs18

# Service name for staging
service: staging

# Environment variables specific to staging
env_variables:
  NODE_ENV: staging
  NEXTAUTH_URL: https://staging-dot-PROJECT_ID.uc.r.appspot.com
  NEXTAUTH_SECRET: staging-secret-key-here
  DATABASE_URL: postgresql://staging_user:password@/staging_db?host=/cloudsql/PROJECT_ID:REGION:staging-instance
  MAX_FILE_SIZE: "524288000"
  MAX_CHUNK_SIZE: "5242880"
  MIN_CHUNK_SIZE: "1048576"
  STORAGE_TYPE: local
  RATE_LIMIT_REQUESTS: "5000"
  RATE_LIMIT_WINDOW: "60000"
  E2E_TESTING: "true"

# Cloud SQL instance for staging
beta_settings:
  cloud_sql_instances: PROJECT_ID:REGION:staging-instance

# Health check configuration
readiness_check:
  path: "/api/health"
  check_interval_sec: 5
  timeout_sec: 4
  failure_threshold: 2
  success_threshold: 2
  app_start_timeout_sec: 300

liveness_check:
  path: "/api/health"
  check_interval_sec: 30
  timeout_sec: 4
  failure_threshold: 4
  success_threshold: 2

# Auto scaling configuration - more aggressive for staging
automatic_scaling:
  target_cpu_utilization: 0.8
  target_throughput_utilization: 0.8
  min_instances: 1
  max_instances: 5
  min_pending_latency: 30ms
  max_pending_latency: automatic
  max_idle_instances: 2

# Resource allocation - smaller for staging
resources:
  cpu: 1
  memory_gb: 1
  disk_size_gb: 10

# Network configuration
network:
  forwarded_ports:
    - 3000